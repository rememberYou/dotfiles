#!/bin/bash
#
# wall-unplash is a script that will randomly set a wallpaper from Unsplash based
# on the resolution of your screen and a collection of names or not.
#
# In order to fill in a new collection of images, go directly to the Unsplash
# (https://unsplash.com/) website and fill in the ID of the collection in
# COLLECTION_IDS.
#
# Finally, if you like the background, you just have to move the temporary image
# (set by SAVE_PATH) to the place concerned.

FILENAME="unsplash_wallpaper.jpg"
RESOLUTION="$(xrandr | grep "*" | awk '{print $1}' | sed -n '1 p')"
SAVE_PATH="$HOME/Pictures"

COLLECTION_IDS=(
    "490"
    "414905"
    "62890"
    "8803481"
)
COLLECTION_NAMES=(
    "Architecture"
    "Christmas"
    "Forest"
    "Milano"
)

if [[ ! (-z "${COLLECTION_IDS}") && ! (-z "${COLLECTION_NAMES}") ]]; then
    prompt_collections=""
	for i in "${!COLLECTION_NAMES[@]}"; do
		prompt_collections+="$i - ${COLLECTION_NAMES[$i]}\n"
	done

	get_id=`echo -e "$prompt_collections" |
            rofi -dmenu -no-custom -i -p "ðŸ–¼ Unsplash Manager:" |
            awk '{print $1}'`

    if [ ${#get_id} -gt 0 ]; then
		COLLECTION_ID=${COLLECTION_IDS[$get_id]}
		API_URL="https://source.unsplash.com/collection/$COLLECTION_ID/$RESOLUTION"
	fi
else
	API_URL="https://source.unsplash.com/collection/$RESOLUTION"
fi

notify-send -t 1000 "ðŸ–¼ Unsplash manager" "Downloading wallpaper..."
wget -O "$SAVE_PATH/$FILENAME" "$API_URL" -q
# swaymsg 'output * bg "$SAVE_PATH/$FILENAME" fill'
feh --bg-scale "$SAVE_PATH/$FILENAME"
notify-send -t 3000 "ðŸ–¼ Unsplash manager" "The wallpaper has been updated!"
